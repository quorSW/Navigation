<!DOCTYPE html>
<html lang="ru" style="background:#07070f!important;color-scheme:dark!important">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#07070f">
<meta name="color-scheme" content="dark">
<title>INVESTAT · Навигация</title>
<!-- Telegram WebApp SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<!-- Fonts MUST be before style block -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;600;700;900&family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
/* ══ NUCLEAR DARK OVERRIDE — kills Telegram light theme ══ */
:root{color-scheme:dark!important}
html,body{color-scheme:dark!important;background:#07070f!important;background-color:#07070f!important}
/* Target every possible element */
*,*::before,*::after{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
/* iOS Safari WebView specific fixes */
:root{-webkit-text-size-adjust:100%}

:root{
  --bg:    #07070f;
  --bg2:   #0c0c1a;
  --bg3:   #111122;
  --card:  #111122;
  --card2: #18182a;
  --brd:   rgba(255,255,255,0.07);
  --brd2:  rgba(255,255,255,0.11);
  --acc:   #3d5af1;
  --acc2:  #6c3de8;
  --glow:  rgba(61,90,241,0.28);
  --grn:   #0baa6e;
  --red:   #e03050;
  --text:  #eeeeff;
  --txt2:  #7777aa;
  --txt3:  #3a3a60;
  --tab:   62px;
}

*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}

/* ★ Critical: force dark background on ALL elements */
html,body{
  font-family:'Manrope',sans-serif;
  background:#07070f!important;
  background-color:#07070f!important;
  color:#eeeeff!important;
  height:100%;
  overflow:hidden;
  -webkit-text-size-adjust:100%;
}

/* Override any Telegram injected styles */
body *{-webkit-font-smoothing:antialiased}

.screen{display:none;flex-direction:column;height:100vh;background:#07070f}
.screen.active{display:flex}

/* ══ AUTH ══════════════════════════════════════════ */
#auth-screen{position:relative;overflow:hidden}
.orb{position:absolute;border-radius:50%;pointer-events:none}
.o1{top:-100px;right:-80px;width:360px;height:360px;background:radial-gradient(circle,rgba(61,90,241,.18) 0%,transparent 70%)}
.o2{bottom:-80px;left:-100px;width:300px;height:300px;background:radial-gradient(circle,rgba(108,61,232,.14) 0%,transparent 70%)}

.ascroll{position:relative;z-index:1;overflow-y:auto;height:100vh;padding:0 20px 40px;-webkit-overflow-scrolling:touch;background:#07070f}

.alogo{display:flex;flex-direction:column;align-items:center;padding:44px 0 26px}
.aring{width:64px;height:64px;border-radius:18px;background:linear-gradient(135deg,var(--acc),var(--acc2));display:flex;align-items:center;justify-content:center;box-shadow:0 0 40px var(--glow);margin-bottom:14px}
.aname{font-family:'Unbounded',sans-serif;font-size:20px;font-weight:700;letter-spacing:.04em;color:#eeeeff}
.asub{font-size:12px;color:#7777aa;margin-top:4px}

.seg{display:flex;background:#111122;border-radius:12px;padding:3px;gap:3px;margin-bottom:20px}
.segb{flex:1;padding:10px;border:none;border-radius:9px;background:transparent;color:#7777aa;font-family:'Manrope',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s}
.segb.on{background:linear-gradient(135deg,var(--acc),var(--acc2));color:#fff;box-shadow:0 3px 14px var(--glow)}

.fg{margin-bottom:12px}
.fl{display:flex;align-items:center;gap:5px;font-size:11px;font-weight:700;color:#7777aa;margin-bottom:5px;letter-spacing:.07em;text-transform:uppercase}
.fw{position:relative}
.fi{
  width:100%;padding:13px 44px 13px 42px;
  background:#18182a!important;
  background-color:#18182a!important;
  /* ★ The box-shadow trick beats Telegram's color override */
  box-shadow:inset 0 0 0 1000px #18182a!important;
  border:1.5px solid rgba(255,255,255,0.11);
  border-radius:11px;color:#eeeeff!important;
  -webkit-text-fill-color:#eeeeff!important;
  font-family:'Manrope',sans-serif;font-size:14px;font-weight:500;
  outline:none;transition:border-color .2s;-webkit-appearance:none!important;appearance:none!important;
  caret-color:#3d5af1;
}
.fi:focus{border-color:#3d5af1;box-shadow:inset 0 0 0 1000px #1e1e35!important}
.fi.er{border-color:var(--red)!important}
/* Fix autofill background */
.fi:-webkit-autofill,.fi:-webkit-autofill:hover,.fi:-webkit-autofill:focus{
  -webkit-text-fill-color:#eeeeff!important;
  -webkit-box-shadow:0 0 0 1000px #18182a inset!important;
  caret-color:#3d5af1;
}
.fi::placeholder{color:#3a3a60!important;-webkit-text-fill-color:#3a3a60!important}
.fico{position:absolute;left:13px;top:50%;transform:translateY(-50%);opacity:.38;display:flex;pointer-events:none;color:#eeeeff}
.feye{position:absolute;right:12px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;opacity:.32;display:flex;transition:opacity .2s;color:#eeeeff}
.feye:hover{opacity:.65}

.hint{font-size:11px;margin-top:4px;padding-left:2px;display:none}
.hint.ok{display:block;color:var(--grn)}.hint.er2{display:block;color:var(--red)}
.sbar{height:3px;border-radius:2px;background:#18182a;margin-top:5px;overflow:hidden}
.sfill{height:100%;border-radius:2px;transition:width .3s,background .3s;width:0}

.aerr{display:none;padding:11px 13px;border-radius:10px;font-size:12px;font-weight:500;margin-bottom:12px;line-height:1.4;background:rgba(224,48,80,.1);border:1px solid rgba(224,48,80,.22);color:#ff8099}
.aerr.show{display:block}

.abtn{width:100%;padding:15px;margin-top:6px;background:linear-gradient(135deg,var(--acc),var(--acc2));border:none;border-radius:11px;color:#fff;font-family:'Unbounded',sans-serif;font-size:12px;font-weight:700;cursor:pointer;letter-spacing:.05em;box-shadow:0 4px 22px var(--glow);transition:transform .15s}
.abtn:active{transform:scale(.97)}
.alegal{text-align:center;margin-top:16px;font-size:11px;color:#3a3a60;line-height:1.5}

/* ══ APP SHELL ═════════════════════════════════════ */
#app-screen{background:#07070f}

.topbar{
  display:flex;align-items:center;justify-content:space-between;
  padding:12px 16px 10px;
  background:#0c0c1a;
  border-bottom:1px solid rgba(255,255,255,0.07);
  flex-shrink:0;
}
.topbar-t{font-family:'Unbounded',sans-serif;font-size:15px;font-weight:700;color:#eeeeff}
.topav{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,var(--acc),var(--acc2));display:flex;align-items:center;justify-content:center;font-family:'Unbounded',sans-serif;font-size:13px;font-weight:700;color:#fff;cursor:pointer;box-shadow:0 2px 8px var(--glow)}

.page{display:none;flex:1;overflow-y:auto;padding-bottom:calc(var(--tab) + 10px);-webkit-overflow-scrolling:touch;background:#07070f}
.page.active{display:block}

/* ══ HERO ══════════════════════════════════════════ */
.hero{margin:12px;border-radius:18px;overflow:hidden;position:relative;height:165px;background:linear-gradient(135deg,#0a1855 0%,#1e3a8a 50%,#070720 100%)}
/* Animated geometric shapes inside hero */
.hero-shapes{position:absolute;inset:0;overflow:hidden}
.hs1{position:absolute;top:-30px;right:-30px;width:200px;height:200px;border-radius:50%;background:radial-gradient(circle,rgba(61,90,241,.5) 0%,transparent 65%);animation:pulse 4s ease-in-out infinite}
.hs2{position:absolute;bottom:-40px;left:30px;width:150px;height:150px;border-radius:50%;background:radial-gradient(circle,rgba(108,61,232,.35) 0%,transparent 65%);animation:pulse 4s ease-in-out infinite .8s}
.hs3{position:absolute;top:20px;left:40%;width:80px;height:80px;border-radius:50%;background:radial-gradient(circle,rgba(255,255,255,.06) 0%,transparent 70%);animation:pulse 3s ease-in-out infinite .4s}
@keyframes pulse{0%,100%{transform:scale(1);opacity:.8}50%{transform:scale(1.08);opacity:1}}
/* SVG building illustration */
.hero-svg{position:absolute;right:16px;bottom:12px;opacity:.18}
.hero-cnt{position:relative;z-index:2;padding:18px;height:100%;display:flex;flex-direction:column;justify-content:space-between}
.hero-title{font-family:'Unbounded',sans-serif;font-size:20px;font-weight:900;line-height:1.2;color:#fff}
.hero-sub{font-size:12px;color:rgba(255,255,255,.5);margin-top:3px}
.hero-pills{display:flex;gap:7px;flex-wrap:wrap}
.hero-pill{background:rgba(255,255,255,.13);border-radius:7px;padding:5px 10px;font-size:10px;font-weight:600;color:#fff;letter-spacing:.02em}

/* ══ SEARCH (forced dark — fixes Telegram white bg) ══ */
.hswrap{margin:0 12px 12px;position:relative}
.hsip{
  width:100%;padding:12px 14px 12px 42px;
  /* ★ Use box-shadow trick — background is overridden by Telegram but box-shadow is not */
  background:#18182a!important;
  background-color:#18182a!important;
  box-shadow:inset 0 0 0 1000px #18182a!important;
  border:1.5px solid rgba(255,255,255,0.13)!important;
  border-radius:12px;
  color:#eeeeff!important;
  -webkit-text-fill-color:#eeeeff!important;
  font-family:'Manrope',sans-serif;font-size:14px;
  outline:none;transition:border-color .2s;
  -webkit-appearance:none!important;
  appearance:none!important;
  caret-color:#3d5af1;
}
.hsip:focus{border-color:#3d5af1!important}
.hsip::placeholder{color:#3a3a60!important;-webkit-text-fill-color:#3a3a60!important}
/* Autofill override */
.hsip:-webkit-autofill,.hsip:-webkit-autofill:focus{
  -webkit-box-shadow:0 0 0 1000px #18182a inset!important;
  -webkit-text-fill-color:#eeeeff!important;
}
.hsico{position:absolute;left:13px;top:50%;transform:translateY(-50%);opacity:.4;display:flex;pointer-events:none;color:#eeeeff}

/* ══ CHIPS ═════════════════════════════════════════ */
.chips{display:flex;gap:7px;padding:0 12px;overflow-x:auto;scrollbar-width:none;margin-bottom:14px}
.chips::-webkit-scrollbar{display:none}
.chip{padding:6px 14px;border-radius:20px;background:#18182a;border:1px solid rgba(255,255,255,.11);color:#7777aa;font-size:12px;font-weight:600;cursor:pointer;white-space:nowrap;flex-shrink:0;transition:all .15s;letter-spacing:.02em}
.chip.on{background:var(--acc);border-color:var(--acc);color:#fff}

/* ══ SECTION TITLE ═════════════════════════════════ */
.sec{font-family:'Unbounded',sans-serif;font-size:10px;font-weight:700;letter-spacing:.1em;color:#7777aa;text-transform:uppercase;padding:0 12px;margin:18px 0 10px}

/* ══ CATEGORY CARDS with SVG illustrations ═════════ */
.catgrid{display:grid;grid-template-columns:1fr 1fr;gap:8px;padding:0 12px}
.ccard{border-radius:14px;overflow:hidden;position:relative;cursor:pointer;height:110px;transition:transform .2s}
.ccard:active{transform:scale(.96)}
.ccard-body{position:absolute;bottom:0;left:0;right:0;padding:10px 12px;z-index:2}
.ccard-cnt{font-size:10px;color:rgba(255,255,255,.5);margin-bottom:2px}
.ccard-name{font-family:'Unbounded',sans-serif;font-size:10px;font-weight:700;letter-spacing:.06em;text-transform:uppercase;color:#fff}
.ccard-ov{position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,.75) 0%,rgba(0,0,0,.1) 60%,transparent 100%);z-index:1}
.ccard-illus{position:absolute;right:8px;top:8px;opacity:.25}

/* ══ REFERRAL BANNER ══════════════════════════════ */
.refb{margin:0 12px 4px;background:#18182a;border:1px solid rgba(255,255,255,.11);border-radius:14px;padding:13px;display:flex;align-items:center;gap:11px}
.rbico{width:40px;height:40px;border-radius:10px;background:linear-gradient(135deg,var(--acc),var(--acc2));display:flex;align-items:center;justify-content:center;flex-shrink:0}
.rbt{flex:1;min-width:0}
.rbth{font-size:13px;font-weight:700;margin-bottom:2px;color:#eeeeff}
.rbtl{font-size:11px;color:#7777aa;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.rbcp{background:#111122;border:1px solid rgba(255,255,255,.11);border-radius:8px;padding:7px 10px;display:flex;align-items:center;gap:4px;font-size:11px;font-weight:600;color:#7777aa;cursor:pointer;flex-shrink:0;white-space:nowrap;transition:all .15s}
.rbcp:active{background:var(--acc);color:#fff;border-color:var(--acc)}

/* ══ RECENT LIST ══════════════════════════════════ */
.rlist{padding:0 12px}
.rpost{display:flex;gap:10px;align-items:flex-start;padding:12px;border-radius:13px;background:#111122;border:1px solid rgba(255,255,255,.07);margin-bottom:8px;cursor:pointer;transition:opacity .15s}
.rpost:active{opacity:.75}
.rthumb{width:60px;height:60px;border-radius:10px;flex-shrink:0;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden}
.rthumb-ov{position:absolute;inset:0;display:flex;align-items:center;justify-content:center}
.ri{flex:1;min-width:0}
.rt{font-size:13px;font-weight:600;line-height:1.35;margin-bottom:5px;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;color:#eeeeff}
.rm{display:flex;align-items:center;gap:6px;flex-wrap:wrap}

/* ══ POST CARDS ════════════════════════════════════ */
.pcards{padding:0 12px}
.pcard{background:#111122;border-radius:14px;border:1px solid rgba(255,255,255,.07);margin-bottom:8px;cursor:pointer;overflow:hidden;transition:transform .15s}
.pcard:active{transform:scale(.99)}
.pcard-img{width:100%;height:130px;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center}
.pcard-img-ov{position:absolute;bottom:0;left:0;right:0;height:50%;background:linear-gradient(to top,rgba(0,0,0,.5),transparent)}
.pcard-body{padding:12px 13px 13px}
.pcard-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:7px}
.pcard-title{font-size:14px;font-weight:700;line-height:1.35;flex:1;margin-right:8px;color:#eeeeff}
.favbtn{background:none;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:8px;transition:transform .2s;flex-shrink:0;color:#7777aa}
.favbtn:active{transform:scale(1.3)}.favbtn.on{color:#fbbf24}
.pcard-prev{font-size:12px;color:#7777aa;line-height:1.5;margin-bottom:10px;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}
.pcard-foot{display:flex;gap:6px;flex-wrap:wrap;align-items:center}

/* ══ COMMUNITY ════════════════════════════════════ */
.clist{padding:12px}
.ci{display:flex;align-items:center;gap:12px;padding:14px;background:#111122;border-radius:13px;border:1px solid rgba(255,255,255,.07);margin-bottom:8px;cursor:pointer;transition:opacity .15s}
.ci:active{opacity:.75}
.ciico{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.cib{flex:1}
.cit{font-size:14px;font-weight:600;margin-bottom:2px;color:#eeeeff}
.cis{font-size:12px;color:#7777aa}
.ciarr{color:#3a3a60}
.csec{font-family:'Unbounded',sans-serif;font-size:10px;font-weight:700;letter-spacing:.08em;color:#7777aa;text-transform:uppercase;padding:0 12px;margin:16px 0 8px}
.repbox{margin:12px;border-radius:13px;background:rgba(224,48,80,.07);border:1px solid rgba(224,48,80,.18);padding:14px}
.rept{font-size:13px;font-weight:700;color:#ff8099;margin-bottom:4px;display:flex;align-items:center;gap:6px}
.reps{font-size:12px;color:#7777aa;line-height:1.5}

/* ══ PROJECTS ══════════════════════════════════════ */
.pjitem{display:flex;align-items:center;gap:12px;padding:14px;background:#111122;border-radius:13px;border:1px solid rgba(255,255,255,.07);margin-bottom:8px;cursor:pointer;transition:opacity .15s}
.pjitem:active{opacity:.75}
.pjav{width:46px;height:46px;border-radius:14px;flex-shrink:0;display:flex;align-items:center;justify-content:center}
.pjb{flex:1}
.pjt{font-size:14px;font-weight:600;margin-bottom:3px;color:#eeeeff}
.pjs{font-size:12px;color:#7777aa}
.pjbdg{background:var(--acc);border-radius:20px;padding:2px 8px;font-size:10px;font-weight:700;color:#fff}
.addpj{margin:0 12px;padding:14px;background:#18182a;border:1.5px dashed rgba(255,255,255,.11);border-radius:13px;display:flex;align-items:center;justify-content:center;gap:8px;font-size:13px;font-weight:600;color:#7777aa;cursor:pointer;transition:all .15s}
.addpj:active{border-color:var(--acc);color:var(--acc)}

/* ══ AMBASSADORS ═══════════════════════════════════ */
.amhdr{margin:12px;border-radius:18px;overflow:hidden;position:relative;height:140px;background:linear-gradient(135deg,#0a1855 0%,#1e3a8a 60%,#0f1f60 100%)}
.amhdr-shapes{position:absolute;inset:0;overflow:hidden}
.amhs1{position:absolute;top:-20px;right:-20px;width:160px;height:160px;border-radius:50%;background:radial-gradient(circle,rgba(61,90,241,.5) 0%,transparent 65%)}
.amhdr-cnt{position:relative;z-index:2;padding:18px;height:100%;display:flex;flex-direction:column;justify-content:flex-end}
.amhdr-t{font-family:'Unbounded',sans-serif;font-size:18px;font-weight:900;color:#fff}
.amhdr-s{font-size:12px;color:rgba(255,255,255,.55);margin-top:3px}

.amprof{margin:0 12px 10px;background:#111122;border-radius:14px;border:1px solid rgba(255,255,255,.07);padding:15px}
.ampt{display:flex;align-items:center;gap:12px;margin-bottom:13px}
.amav{width:52px;height:52px;border-radius:14px;background:linear-gradient(135deg,var(--acc),var(--acc2));display:flex;align-items:center;justify-content:center;font-family:'Unbounded',sans-serif;font-size:20px;font-weight:700;color:#fff}
.amname{font-family:'Unbounded',sans-serif;font-size:15px;font-weight:700;color:#eeeeff}
.amlvl{font-size:12px;color:#7777aa;margin-top:2px}
.amstats{display:flex;gap:8px}
.asb{flex:1;background:#111122;border-radius:10px;padding:11px 8px;text-align:center;border:1px solid rgba(255,255,255,.07)}
.asn{font-family:'Unbounded',sans-serif;font-size:18px;font-weight:800;color:var(--acc)}
.asl{font-size:10px;color:#7777aa;margin-top:2px}

/* Referral levels */
.lvl-cards{display:flex;gap:8px;padding:0 12px;overflow-x:auto;scrollbar-width:none;margin-bottom:4px}
.lvl-cards::-webkit-scrollbar{display:none}
.lvlcard{flex-shrink:0;width:110px;border-radius:12px;padding:12px 10px;border:1.5px solid rgba(255,255,255,.08);background:#18182a;text-align:center}
.lvlcard.active{border-color:var(--acc);background:rgba(61,90,241,.1)}
.lvl-ico{font-size:20px;margin-bottom:5px}
.lvl-name{font-family:'Unbounded',sans-serif;font-size:9px;font-weight:700;letter-spacing:.06em;text-transform:uppercase;margin-bottom:3px;color:#eeeeff}
.lvl-req{font-size:10px;color:#7777aa}

.pgbox{margin:0 12px 10px;background:#111122;border-radius:13px;border:1px solid rgba(255,255,255,.07);padding:14px}
.pgt{font-size:13px;font-weight:700;margin-bottom:8px;color:#eeeeff}
.pgbar{height:6px;background:#18182a;border-radius:4px;overflow:hidden}
.pgfill{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--acc),var(--acc2));width:0;transition:width 1.2s ease}
.pgs{font-size:11px;color:#7777aa;margin-top:6px}

.amref{margin:0 12px 10px;background:#111122;border-radius:13px;border:1px solid rgba(255,255,255,.07);padding:14px}
.amrh{font-size:12px;font-weight:700;margin-bottom:8px;display:flex;align-items:center;gap:6px;color:#eeeeff}
.amrl{background:#07070f;border-radius:9px;padding:10px 12px;font-size:12px;color:#7777aa;display:flex;align-items:center;justify-content:space-between;cursor:pointer;gap:8px;border:1px solid rgba(255,255,255,.05)}
.amrl span:first-child{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.amrl:active{background:#111122}

/* Leaderboard */
.lb{margin:0 12px}
.lbi{display:flex;align-items:center;gap:10px;padding:12px;background:#111122;border-radius:12px;border:1px solid rgba(255,255,255,.07);margin-bottom:7px}
.lbr{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-family:'Unbounded',sans-serif;font-size:11px;font-weight:700;flex-shrink:0}
.r1{background:linear-gradient(135deg,#d4a011,#f0c840);color:#000}
.r2{background:linear-gradient(135deg,#808080,#b0b0b0);color:#000}
.r3{background:linear-gradient(135deg,#9d5a2a,#c07840);color:#fff}
.rn{background:#18182a;color:#7777aa}
.lbav{width:36px;height:36px;border-radius:50%;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-family:'Unbounded',sans-serif;font-size:13px;font-weight:700;color:#fff}
/* ★ current user highlight */
.lbi.me{border-color:var(--acc);background:rgba(61,90,241,.08)}
.lbi.me .lbn{color:var(--acc)}
.lbn{flex:1;font-size:13px;font-weight:600;color:#eeeeff}
.lbs{font-family:'Unbounded',sans-serif;font-size:13px;font-weight:700;color:var(--acc)}

.shoprow{display:flex;gap:8px;overflow-x:auto;scrollbar-width:none;padding:0 12px 4px}
.shoprow::-webkit-scrollbar{display:none}
.shopc{flex-shrink:0;width:140px;border-radius:13px;overflow:hidden;background:#111122;border:1px solid rgba(255,255,255,.07);cursor:pointer;transition:opacity .15s}
.shopc:active{opacity:.75}
.shopi{height:85px;display:flex;align-items:center;justify-content:center}
.shopb{padding:9px 10px}
.shopn{font-size:11px;font-weight:700;margin-bottom:2px;color:#eeeeff}
.shopp{font-size:10px;color:#7777aa}

.amout{margin:10px 12px 24px;padding:14px;background:rgba(224,48,80,.09);border:1px solid rgba(224,48,80,.2);border-radius:13px;color:#ff8099;font-size:13px;font-weight:600;cursor:pointer;text-align:center;transition:all .15s}
.amout:active{background:rgba(224,48,80,.18)}

/* ══ POST DETAIL ═══════════════════════════════════ */
#det{display:none;position:fixed;inset:0;background:#07070f;z-index:100;overflow-y:auto;-webkit-overflow-scrolling:touch}
#det.show{display:block}

.dhead{padding:11px 14px;display:flex;align-items:center;gap:10px;border-bottom:1px solid rgba(255,255,255,.07);position:sticky;top:0;background:#07070f;z-index:10}
.dback{width:36px;height:36px;border-radius:10px;background:#111122;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;color:#eeeeff;flex-shrink:0;transition:background .15s}
.dback:active{background:#18182a}
.dht{font-size:14px;font-weight:600;flex:1;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;color:#eeeeff}

/* Detail hero — big SVG illustration */
.dhero{width:100%;height:200px;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center}
.dhero-ov{position:absolute;bottom:0;left:0;right:0;height:80px;background:linear-gradient(to top,#07070f,transparent);z-index:2}

.dcnt{padding:18px 18px 28px}
.dbadges{display:flex;gap:6px;margin-bottom:12px;flex-wrap:wrap;align-items:center}
.dtitle{font-family:'Unbounded',sans-serif;font-size:19px;font-weight:800;line-height:1.25;margin-bottom:14px;color:#eeeeff}
.dbody{font-size:14px;line-height:1.78;color:rgba(238,238,255,.8);white-space:pre-line;margin-bottom:20px}
.dtags{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:24px}

/* ★ Action buttons — matching screenshot exactly */
.dactions{display:flex;gap:10px}
.dbtn{flex:1;display:flex;align-items:center;justify-content:center;gap:8px;padding:16px;border-radius:14px;border:none;cursor:pointer;font-family:'Manrope',sans-serif;font-size:14px;font-weight:700;transition:transform .15s,opacity .15s;text-decoration:none}
.dbtn:active{transform:scale(.97);opacity:.9}
.btn-watch{background:linear-gradient(135deg,var(--acc),var(--acc2));color:#fff;box-shadow:0 4px 18px var(--glow)}
.btn-consp{background:#18182a;color:#eeeeff;border:1.5px solid rgba(255,255,255,.11)}
.btn-consp:active{background:#111122}

/* ══ BADGES & TAGS ═════════════════════════════════ */
.badge{padding:3px 9px;border-radius:6px;font-size:10px;font-weight:700;letter-spacing:.06em;text-transform:uppercase;white-space:nowrap}
.b-post{background:rgba(61,90,241,.18);color:#818cf8}
.b-video{background:rgba(108,61,232,.18);color:#a78bfa}
.b-invest{background:rgba(232,100,10,.18);color:#fb923c}
.b-case{background:rgba(212,160,17,.18);color:#fbbf24}
.b-news{background:rgba(11,170,110,.18);color:#34d399}
.tag{font-size:10px;color:#7777aa;background:rgba(255,255,255,.05);padding:3px 8px;border-radius:5px}

/* ══ BOTTOM NAV ════════════════════════════════════ */
.bnav{position:fixed;bottom:0;left:0;right:0;background:#0c0c1a;border-top:1px solid rgba(255,255,255,.07);display:flex;align-items:stretch;z-index:50;padding-bottom:env(safe-area-inset-bottom,0px)}
.ntab{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px;padding:9px 4px;cursor:pointer;color:#3a3a60;transition:color .15s;border:none;background:none;min-height:var(--tab)}
.ntab.on{color:var(--acc)}
.ntab svg{width:22px;height:22px;flex-shrink:0}
.ntabl{font-size:9px;font-weight:600;letter-spacing:.03em;line-height:1;color:inherit}

/* TOAST */
.toast{position:fixed;bottom:calc(var(--tab) + 14px);left:50%;transform:translateX(-50%) translateY(14px);background:#18182a;border:1px solid rgba(255,255,255,.11);border-radius:12px;padding:10px 18px;font-size:12px;font-weight:600;color:#eeeeff;opacity:0;transition:all .3s;z-index:200;white-space:nowrap;pointer-events:none}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* EMPTY */
.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 24px;text-align:center;gap:8px}
.empt{font-family:'Unbounded',sans-serif;font-size:14px;color:#eeeeff}.emps{font-size:12px;color:#7777aa}
</style>
</head>
<body>

<!-- ════════ SVG DEFS — reusable illustrations ════════ -->
<svg width="0" height="0" style="position:absolute">
  <defs>
    <!-- Building/city illustration -->
    <symbol id="ico-building" viewBox="0 0 80 80">
      <rect x="10" y="30" width="20" height="42" fill="currentColor" opacity=".9"/>
      <rect x="35" y="18" width="22" height="54" fill="currentColor" opacity=".8"/>
      <rect x="62" y="38" width="16" height="34" fill="currentColor" opacity=".7"/>
      <rect x="13" y="34" width="4" height="4" fill="white" opacity=".3"/>
      <rect x="20" y="34" width="4" height="4" fill="white" opacity=".3"/>
      <rect x="13" y="42" width="4" height="4" fill="white" opacity=".3"/>
      <rect x="20" y="42" width="4" height="4" fill="white" opacity=".3"/>
      <rect x="38" y="22" width="5" height="5" fill="white" opacity=".3"/>
      <rect x="47" y="22" width="5" height="5" fill="white" opacity=".3"/>
      <rect x="38" y="31" width="5" height="5" fill="white" opacity=".5"/>
      <rect x="47" y="31" width="5" height="5" fill="white" opacity=".3"/>
      <rect x="38" y="40" width="5" height="5" fill="white" opacity=".3"/>
      <rect x="47" y="40" width="5" height="5" fill="white" opacity=".5"/>
    </symbol>
    <!-- Chart/analytics -->
    <symbol id="ico-chart" viewBox="0 0 80 80">
      <rect x="8" y="56" width="12" height="16" rx="2" fill="currentColor" opacity=".7"/>
      <rect x="25" y="40" width="12" height="32" rx="2" fill="currentColor" opacity=".8"/>
      <rect x="42" y="26" width="12" height="46" rx="2" fill="currentColor" opacity=".9"/>
      <rect x="59" y="16" width="12" height="56" rx="2" fill="currentColor"/>
      <polyline points="14,56 31,40 48,26 65,16" fill="none" stroke="white" stroke-width="2" opacity=".4"/>
    </symbol>
    <!-- Video play -->
    <symbol id="ico-play" viewBox="0 0 80 80">
      <circle cx="40" cy="40" r="30" fill="currentColor" opacity=".3"/>
      <circle cx="40" cy="40" r="22" fill="currentColor" opacity=".5"/>
      <polygon points="34,30 58,40 34,50" fill="white" opacity=".8"/>
    </symbol>
    <!-- News / newspaper -->
    <symbol id="ico-news" viewBox="0 0 80 80">
      <rect x="12" y="16" width="46" height="52" rx="4" fill="currentColor" opacity=".7"/>
      <rect x="58" y="22" width="12" height="40" rx="2" fill="currentColor" opacity=".5"/>
      <rect x="18" y="24" width="28" height="6" rx="2" fill="white" opacity=".4"/>
      <rect x="18" y="34" width="22" height="4" rx="2" fill="white" opacity=".3"/>
      <rect x="18" y="42" width="26" height="4" rx="2" fill="white" opacity=".25"/>
      <rect x="18" y="50" width="20" height="4" rx="2" fill="white" opacity=".2"/>
    </symbol>
    <!-- Coin / invest -->
    <symbol id="ico-coin" viewBox="0 0 80 80">
      <circle cx="40" cy="40" r="28" fill="currentColor" opacity=".8"/>
      <circle cx="40" cy="40" r="22" fill="currentColor" opacity=".5"/>
      <text x="40" y="47" text-anchor="middle" font-size="22" font-weight="700" fill="white" opacity=".7">₽</text>
    </symbol>
    <!-- Case / briefcase -->
    <symbol id="ico-case" viewBox="0 0 80 80">
      <rect x="12" y="28" width="56" height="38" rx="4" fill="currentColor" opacity=".8"/>
      <rect x="28" y="18" width="24" height="14" rx="3" fill="none" stroke="currentColor" stroke-width="4" opacity=".7"/>
      <line x1="12" y1="45" x2="68" y2="45" stroke="white" stroke-width="2" opacity=".25"/>
      <rect x="36" y="40" width="8" height="10" rx="2" fill="white" opacity=".35"/>
    </symbol>
    <!-- Education / book -->
    <symbol id="ico-edu" viewBox="0 0 80 80">
      <rect x="14" y="14" width="36" height="52" rx="3" fill="currentColor" opacity=".8"/>
      <rect x="50" y="14" width="18" height="52" rx="3" fill="currentColor" opacity=".5"/>
      <rect x="20" y="22" width="24" height="4" rx="2" fill="white" opacity=".4"/>
      <rect x="20" y="30" width="20" height="4" rx="2" fill="white" opacity=".3"/>
      <rect x="20" y="38" width="22" height="4" rx="2" fill="white" opacity=".25"/>
    </symbol>
  </defs>
</svg>

<!-- ════════ AUTH ════════════════════════════════════ -->
<div id="auth-screen" class="screen active">
  <div class="orb o1"></div><div class="orb o2"></div>
  <div class="ascroll">
    <div class="alogo">
      <div class="aring">
        <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.8" stroke-linecap="round">
          <line x1="12" y1="2" x2="12" y2="22"/>
          <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
        </svg>
      </div>
      <div class="aname">INVESTAT</div>
      <div class="asub">Аналитика доходной недвижимости</div>
    </div>

    <div class="seg">
      <button class="segb on" id="bl" onclick="sw('l')">Войти</button>
      <button class="segb" id="br" onclick="sw('r')">Регистрация</button>
    </div>

    <!-- LOGIN -->
    <div id="fl">
      <div class="aerr" id="la"></div>
      <div class="fg">
        <div class="fl">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/></svg>
          Email
        </div>
        <div class="fw">
          <span class="fico"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-10 7L2 7"/></svg></span>
          <input class="fi" type="email" id="le" placeholder="example@mail.ru" autocomplete="email">
        </div>
      </div>
      <div class="fg">
        <div class="fl">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2z"/></svg>
          Пароль
        </div>
        <div class="fw">
          <span class="fico"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></span>
          <input class="fi" type="password" id="lp" placeholder="Введите пароль" autocomplete="current-password">
          <button class="feye" type="button" onclick="tp('lp',this)"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button>
        </div>
      </div>
      <button class="abtn" onclick="doLogin()">ВОЙТИ В АККАУНТ</button>
    </div>

    <!-- REGISTER -->
    <div id="fr" style="display:none">
      <div class="aerr" id="ra"></div>
      <div class="fg">
        <div class="fl">Имя</div>
        <div class="fw">
          <span class="fico"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></span>
          <input class="fi" type="text" id="rn" placeholder="Ваше имя" oninput="vN()" autocomplete="given-name">
        </div>
        <div class="hint" id="hn"></div>
      </div>
      <div class="fg">
        <div class="fl">Телефон <span style="color:var(--red);margin-left:2px">*</span></div>
        <div class="fw">
          <span class="fico"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07A19.5 19.5 0 0 1 4.69 12 19.79 19.79 0 0 1 1.61 3.38 2 2 0 0 1 3.58 1h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L7.91 8.96a16 16 0 0 0 6.29 6.29l1.32-1.32a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg></span>
          <input class="fi" type="tel" id="rph" placeholder="+7 (999) 000-00-00" oninput="vPh()" autocomplete="tel">
        </div>
        <div class="hint" id="hph"></div>
      </div>
      <div class="fg">
        <div class="fl">Email <span style="color:var(--red);margin-left:2px">*</span></div>
        <div class="fw">
          <span class="fico"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-10 7L2 7"/></svg></span>
          <input class="fi" type="email" id="rem" placeholder="example@mail.ru" oninput="vE()" autocomplete="email">
        </div>
        <div class="hint" id="hem"></div>
      </div>
      <div class="fg">
        <div class="fl">Пароль <span style="color:var(--red);margin-left:2px">*</span></div>
        <div class="fw">
          <span class="fico"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></span>
          <input class="fi" type="password" id="rp" placeholder="Минимум 8 символов" oninput="vP()" autocomplete="new-password">
          <button class="feye" type="button" onclick="tp('rp',this)"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg></button>
        </div>
        <div class="sbar"><div class="sfill" id="sf"></div></div>
        <div class="hint" id="hp"></div>
      </div>
      <div class="fg">
        <div class="fl">Подтверждение <span style="color:var(--red);margin-left:2px">*</span></div>
        <div class="fw">
          <span class="fico"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4"/><circle cx="12" cy="12" r="10"/></svg></span>
          <input class="fi" type="password" id="rp2" placeholder="Повторите пароль" oninput="vP2()" autocomplete="new-password">
        </div>
        <div class="hint" id="hp2"></div>
      </div>
      <button class="abtn" onclick="doReg()">СОЗДАТЬ АККАУНТ</button>
    </div>
    <div class="alegal">Нажимая кнопку, вы принимаете условия<br>пользовательского соглашения</div>
  </div>
</div>

<!-- ════════ APP ═════════════════════════════════════ -->
<div id="app-screen" class="screen">
  <div class="topbar">
    <div class="topbar-t" id="ptitle">Главная</div>
    <div class="topav" id="topav" onclick="gt('ambassadors',document.querySelectorAll('.ntab')[4])">A</div>
  </div>

  <!-- HOME -->
  <div id="page-home" class="page active">
    <div class="hero">
      <div class="hero-shapes"><div class="hs1"></div><div class="hs2"></div><div class="hs3"></div></div>
      <svg class="hero-svg" width="100" height="90" viewBox="0 0 80 80"><use href="#ico-building" color="white"/></svg>
      <div class="hero-cnt">
        <div>
          <div class="hero-title">INVESTAT</div>
          <div class="hero-sub">Аналитика доходной недвижимости</div>
        </div>
        <div class="hero-pills">
          <div class="hero-pill">До 67% годовых</div>
          <div class="hero-pill">Разборы</div>
          <div class="hero-pill">Кейсы</div>
          <div class="hero-pill">Новости</div>
        </div>
      </div>
    </div>

    <div class="hswrap">
      <span class="hsico"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg></span>
      <input class="hsip" type="search" id="hsi" placeholder="Найти посты, разборы, проекты..." oninput="onHS()" style="background:#18182a!important;background-color:#18182a!important;color:#eeeeff!important;-webkit-text-fill-color:#eeeeff!important;border-color:rgba(255,255,255,0.13)!important">
    </div>

    <div class="chips" id="hchips">
      <div class="chip on" onclick="setHC(this,'all')">Все</div>
      <div class="chip" onclick="setHC(this,'invest')">Инвестиции</div>
      <div class="chip" onclick="setHC(this,'case')">Кейсы</div>
      <div class="chip" onclick="setHC(this,'video')">Видео</div>
      <div class="chip" onclick="setHC(this,'news')">Новости</div>
      <div class="chip" onclick="setHC(this,'post')">Посты</div>
    </div>

    <div id="hsr" style="display:none" class="pcards"></div>

    <div id="hdef">
      <div class="sec">Разделы</div>
      <div class="catgrid" id="catg"></div>

      <div class="sec" style="margin-top:20px">Реферальная программа</div>
      <div class="refb">
        <div class="rbico"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg></div>
        <div class="rbt"><div class="rbth">Пригласи друга</div><div class="rbtl" id="hrl">https://t.me/investat_bot?start=ref_...</div></div>
        <div class="rbcp" onclick="cpHR()"><svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>Копировать</div>
      </div>

      <div class="sec">Последние посты</div>
      <div class="rlist" id="recl"></div>
    </div>
  </div>

  <!-- COMMUNITY -->
  <div id="page-community" class="page">
    <div class="clist">
      <div class="ci" onclick="ol('https://t.me/+c4ekMHlWBbQzYjUy')">
        <div class="ciico" style="background:linear-gradient(135deg,#0a1855,#1e3a8a)">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>
        </div>
        <div class="cib"><div class="cit">INVESTAT</div><div class="cis">Основной канал</div></div>
        <svg class="ciarr" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
      </div>
      <div class="ci" onclick="showT('Скоро доступно')">
        <div class="ciico" style="background:linear-gradient(135deg,#0f2040,#1a3060)">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        </div>
        <div class="cib"><div class="cit">Чат инвесторов</div><div class="cis">Обсуждения и нетворкинг</div></div>
        <svg class="ciarr" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
      </div>
    </div>
    <div class="csec">Правила и поддержка</div>
    <div class="clist" style="padding-top:0">
      <div class="ci" onclick="showT('Открываем правила...')">
        <div class="ciico" style="background:linear-gradient(135deg,#1a1a5a,#0f0f3a)">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#818cf8" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
        </div>
        <div class="cib"><div class="cit">Правила сообщества</div><div class="cis">Изучи перед участием</div></div>
        <svg class="ciarr" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
      </div>
      <div class="ci" onclick="showT('Открываем поддержку...')">
        <div class="ciico" style="background:linear-gradient(135deg,#3a1800,#200e00)">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#fb923c" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        </div>
        <div class="cib"><div class="cit">Служба поддержки</div><div class="cis">Пн–Пт 10:00 – 19:00</div></div>
        <svg class="ciarr" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
      </div>
    </div>
    <div class="repbox">
      <div class="rept"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>Сообщить о нарушении</div>
      <div class="reps">Если пишут в личку со спамом или заметил нарушение — сообщи нам!</div>
    </div>
  </div>

  <!-- PROJECTS -->
  <div id="page-projects" class="page">
    <div style="padding:12px">
      <div class="pjitem" onclick="ol('https://t.me/+c4ekMHlWBbQzYjUy')">
        <div class="pjav" style="background:linear-gradient(135deg,#0a1855,#1e3a8a)"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg></div>
        <div class="pjb"><div class="pjt">Канал INVESTAT</div><div class="pjs">Аналитика доходной недвижимости</div></div>
        <span class="pjbdg">NEW</span>
      </div>
      <div class="pjitem" onclick="showT('Скоро доступно')">
        <div class="pjav" style="background:linear-gradient(135deg,#062a18,#0a3a22)"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg></div>
        <div class="pjb"><div class="pjt">Портал проектов</div><div class="pjs">Рейтинг доходных проектов</div></div>
      </div>
      <div class="pjitem" onclick="showT('Скоро доступно')">
        <div class="pjav" style="background:linear-gradient(135deg,#2a1200,#3a1a00)"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div>
        <div class="pjb"><div class="pjt">Аналитика рынка</div><div class="pjs">Закрытые предложения</div></div>
      </div>
      <div class="pjitem" onclick="showT('Скоро доступно')">
        <div class="pjav" style="background:linear-gradient(135deg,#20082a,#2a1040)"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg></div>
        <div class="pjb"><div class="pjt">Закрытый клуб</div><div class="pjs">Нетворкинг инвесторов</div></div>
      </div>
      <div class="addpj" onclick="showT('Скоро будет доступно')">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
        Добавить проект
      </div>
    </div>
  </div>

  <!-- COLLECTIONS -->
  <div id="page-collections" class="page">
    <div class="pcards" id="colllist" style="padding-top:12px"></div>
  </div>

  <!-- AMBASSADORS -->
  <div id="page-ambassadors" class="page">
    <div class="amhdr">
      <div class="amhdr-shapes"><div class="amhs1"></div></div>
      <div class="amhdr-cnt">
        <div class="amhdr-t">Амбассадоры</div>
        <div class="amhdr-s">Приглашай — расти в рейтинге</div>
      </div>
    </div>

    <div class="amprof">
      <div class="ampt">
        <div class="amav" id="amav">A</div>
        <div><div class="amname" id="amname">—</div><div class="amlvl" id="amlvl">Приятель</div></div>
      </div>
      <div class="amstats">
        <div class="asb"><div class="asn" id="arefs">0</div><div class="asl">Приглашено</div></div>
        <div class="asb"><div class="asn" id="acols">0</div><div class="asl">Подборок</div></div>
        <div class="asb"><div class="asn" id="apts">0</div><div class="asl">Баллов</div></div>
      </div>
    </div>

    <!-- Referral levels -->
    <div class="sec">Уровни амбассадора</div>
    <div class="lvl-cards" id="lvlcards"></div>

    <div class="pgbox">
      <div class="pgt" id="pgtitle">До следующего уровня</div>
      <div class="pgbar"><div class="pgfill" id="pgfill"></div></div>
      <div class="pgs" id="pgsub">Приглашайте друзей по реферальной ссылке</div>
    </div>

    <div class="amref">
      <div class="amrh"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>Реферальная ссылка</div>
      <div class="amrl" onclick="cpRef()">
        <span id="refl">https://t.me/investat_bot?start=ref_...</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="flex-shrink:0"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
      </div>
    </div>

    <div class="sec">Рейтинг амбассадоров</div>
    <div class="lb" id="lbd"></div>

    <div class="sec">Магазин баллов</div>
    <div class="shoprow">
      <div class="shopc" onclick="showT('Скоро доступно')">
        <div class="shopi" style="background:linear-gradient(135deg,#0a1855,#1e3a8a)"><svg width="40" height="40" viewBox="0 0 80 80"><use href="#ico-building" color="white"/></svg></div>
        <div class="shopb"><div class="shopn">Курс «Инвестор»</div><div class="shopp">50 000 баллов</div></div>
      </div>
      <div class="shopc" onclick="showT('Скоро доступно')">
        <div class="shopi" style="background:linear-gradient(135deg,#1a0840,#2a1260)"><svg width="40" height="40" viewBox="0 0 80 80"><use href="#ico-chart" color="white"/></svg></div>
        <div class="shopb"><div class="shopn">Разбор портфеля</div><div class="shopp">25 000 баллов</div></div>
      </div>
      <div class="shopc" onclick="showT('Скоро доступно')">
        <div class="shopi" style="background:linear-gradient(135deg,#062a18,#0a3a22)"><svg width="40" height="40" viewBox="0 0 80 80"><use href="#ico-coin" color="white"/></svg></div>
        <div class="shopb"><div class="shopn">VIP-консультация</div><div class="shopp">100 000 баллов</div></div>
      </div>
    </div>

    <div class="amout" onclick="doLogout()">Выйти из аккаунта</div>
  </div>

  <nav class="bnav">
    <button class="ntab on" onclick="gt('home',this)">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
      <span class="ntabl">Домой</span>
    </button>
    <button class="ntab" onclick="gt('community',this)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
      <span class="ntabl">О сообществе</span>
    </button>
    <button class="ntab" onclick="gt('projects',this)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/></svg>
      <span class="ntabl">Проекты</span>
    </button>
    <button class="ntab" onclick="gt('collections',this)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
      <span class="ntabl">Подборки</span>
    </button>
    <button class="ntab" onclick="gt('ambassadors',this)">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
      <span class="ntabl">Амбассадоры</span>
    </button>
  </nav>
</div>

<!-- ════════ POST DETAIL ══════════════════════════════ -->
<div id="det">
  <div class="dhead">
    <button class="dback" onclick="closeDet()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="m15 18-6-6 6-6"/></svg>
    </button>
    <span class="dht" id="dht">Материал</span>
    <button class="favbtn" id="dfav" onclick="togDF()" style="width:32px;height:32px">
      <svg id="dfsvg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
    </button>
  </div>
  <div class="dhero" id="dhero">
    <div class="dhero-ov"></div>
    <svg id="dherosvg" width="120" height="120" viewBox="0 0 80 80" style="position:relative;z-index:1"></svg>
  </div>
  <div class="dcnt">
    <div class="dbadges" id="dbd"></div>
    <div class="dtitle" id="dtit"></div>
    <div class="dbody" id="dbody"></div>
    <div class="dtags" id="dtags"></div>
    <div class="dactions">
      <a class="dbtn btn-watch" id="dwatch" href="#" target="_blank">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
        Смотреть
      </a>
      <a class="dbtn btn-consp" id="dconsp" href="#" target="_blank">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
        Конспект
      </a>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ══════════ Telegram WebApp init ══════════════════════
(function(){
  try{
    const tg=window.Telegram?.WebApp;
    if(tg){
      tg.ready();
      tg.expand();
      // Force dark theme on Telegram side
      tg.setHeaderColor('#07070f');
      tg.setBackgroundColor('#07070f');
      // Lock to dark theme
      if(tg.colorScheme==='light'){
        // Can't change it, but we override everything via CSS
      }
    }
  }catch(e){}
  // Hard override - runs BEFORE any Telegram style injection
  const forceDark=()=>{
    document.documentElement.style.cssText='background:#07070f!important;background-color:#07070f!important;color-scheme:dark!important';
    document.body.style.cssText='background:#07070f!important;background-color:#07070f!important;color:#eeeeff!important';
    // Find and force all inputs
    document.querySelectorAll('input').forEach(i=>{
      i.style.cssText=(i.style.cssText||'')+';background:#18182a!important;background-color:#18182a!important;color:#eeeeff!important;-webkit-text-fill-color:#eeeeff!important;border-color:rgba(255,255,255,0.11)!important';
    });
  };
  forceDark();
  // Re-apply after DOM mutations (Telegram may inject styles late)
  setTimeout(forceDark,100);
  setTimeout(forceDark,500);
  setTimeout(forceDark,1000);
})();

// ══════════ DATA ══════════════════════════════════════
const POSTS=[
  {id:1,title:'Доходная недвижимость: проекты с доходностью 40–67% годовых',
   content:'Портал INVESTAT собрал лучшие проекты доходной недвижимости с подтверждёнными показателями.\n\nКак отбираем проекты:\n• Проверка юридической чистоты объекта\n• Анализ финансовой модели застройщика\n• Независимая оценка рыночной стоимости\n• История выплат инвесторам\n\nТекущий рейтинг топ-проектов:\n1. Апарт-отель в Сочи — 67% годовых\n2. Коттеджный посёлок МО — 54% годовых\n3. Торговые площади СПб — 41% годовых',
   category:'Инвестиции',tags:'недвижимость,доходность,инвестиции',type:'invest',ico:'ico-coin',
   bg:'linear-gradient(135deg,#0a1855 0%,#1e3a8a 100%)',
   tgLink:'https://t.me/+c4ekMHlWBbQzYjUy',tgConsp:'https://t.me/+c4ekMHlWBbQzYjUy'},
  {id:2,title:'Разбор: квартира в новостройке vs апарт-отель — где выгоднее',
   content:'Сравнил два реальных объекта с одинаковым бюджетом — 5 000 000 ₽.\n\n🏢 Квартира в новостройке МО:\n• Рост стоимости за 2 года: +18%\n• Аренда: 35 000 ₽/мес\n• Итоговая доходность: ~22% годовых\n\n🏨 Апарт-отель в Сочи:\n• Рост стоимости за 2 года: +31%\n• Арендный доход: 58 000 ₽/мес\n• Итоговая доходность: ~47% годовых\n\nВывод: апарт-отель в туристических зонах обгоняет классическую аренду в 2+ раза.',
   category:'Кейсы',tags:'кейс,квартира,апарт-отель',type:'case',ico:'ico-case',
   bg:'linear-gradient(135deg,#1a0840 0%,#3a1a80 100%)',
   tgLink:'https://t.me/+c4ekMHlWBbQzYjUy',tgConsp:'https://t.me/+c4ekMHlWBbQzYjUy'},
  {id:3,title:'Видео: Закрытые предложения — как получить доступ к лучшим проектам',
   content:'В новом видео рассказываю, как работает система закрытых предложений на портале INVESTAT.\n\nЧто внутри:\n— Как формируется база проектов\n— Почему часть объектов видна только участникам\n— Реальные истории инвесторов с цифрами\n— Пошаговый процесс входа в проект\n\nТакже разбираем:\n✅ Как читать финансовую модель\n✅ На что смотреть в договоре\n✅ Когда выходить из проекта\n\nДлительность: 38 минут.',
   category:'Видео',tags:'видео,закрытые предложения',type:'video',ico:'ico-play',
   bg:'linear-gradient(135deg,#0a3020 0%,#1a6040 100%)',
   tgLink:'https://t.me/+c4ekMHlWBbQzYjUy',tgConsp:'https://t.me/+c4ekMHlWBbQzYjUy'},
  {id:4,title:'Аналитика: рынок доходной недвижимости в 2025 году',
   content:'Подготовил большой аналитический обзор рынка на 2025 год.\n\n📈 Главные тренды:\n1. Апарт-отели в туристических зонах — рост спроса +34%\n2. Коммерческая недвижимость в регионах — недооценённый сегмент\n3. Краудлендинг в недвижимости — объём рынка удвоился\n\n⚠️ Риски:\n— Ужесточение требований к застройщикам\n— Рост стоимости строительных материалов\n\n🎯 Где искать доходность выше 40%:\nСочи, Казань, Калининград, горнолыжные курорты.',
   category:'Аналитика',tags:'аналитика,рынок,2025',type:'post',ico:'ico-chart',
   bg:'linear-gradient(135deg,#301000 0%,#602008 100%)',
   tgLink:'https://t.me/+c4ekMHlWBbQzYjUy',tgConsp:'https://t.me/+c4ekMHlWBbQzYjUy'},
  {id:5,title:'Новость: ЦБ ужесточает требования к инвестиционным платформам',
   content:'Банк России ввёл новые требования к застройщикам и инвестиционным платформам.\n\nЧто изменилось:\n📌 Обязательный аудит финансовой отчётности\n📌 Новые стандарты раскрытия информации\n📌 Увеличение резервов для краудлендинговых платформ\n\nЧто это значит для инвесторов:\n✅ Повышается прозрачность рынка\n✅ Ненадёжные платформы уйдут с рынка\n\nПортал INVESTAT прошёл все проверки и продолжает работу.',
   category:'Новости',tags:'новости,ЦБ,регулирование',type:'news',ico:'ico-news',
   bg:'linear-gradient(135deg,#002030 0%,#004060 100%)',
   tgLink:'https://t.me/+c4ekMHlWBbQzYjUy',tgConsp:'https://t.me/+c4ekMHlWBbQzYjUy'},
  {id:6,title:'Кейс: 2 400 000 ₽ за 18 месяцев на доходной недвижимости',
   content:'Делюсь реальным кейсом из своей практики.\n\nСтартовый капитал: 3 600 000 ₽\nОбъект: апартаменты в Сочи\nСрок: 18 месяцев\n\nРезультат:\n💰 Арендный доход за 18 мес: 940 000 ₽\n📈 Прирост стоимости объекта: 1 460 000 ₽\n🎯 Итого заработано: 2 400 000 ₽\n🔢 Доходность: 44,4% годовых\n\nЧто помогло:\n1. Правильная управляющая компания\n2. Покупка на этапе котлована\n3. Вход через закрытое предложение INVESTAT — цена ниже рынка на 12%',
   category:'Кейсы',tags:'кейс,Сочи,44% годовых',type:'case',ico:'ico-building',
   bg:'linear-gradient(135deg,#0a2010 0%,#1a5030 100%)',
   tgLink:'https://t.me/+c4ekMHlWBbQzYjUy',tgConsp:'https://t.me/+c4ekMHlWBbQzYjUy'},
  {id:7,title:'Чек-лист: 12 вопросов перед входом в инвестиционный проект',
   content:'Сохрани этот чек-лист — он сэкономит деньги и нервы.\n\n📋 Юридическая часть:\n☐ Право собственности на землю\n☐ Разрешение на строительство\n☐ Договор с управляющей компанией\n☐ Эскроу-счёт или альтернативные гарантии\n\n📊 Финансовая модель:\n☐ Откуда берётся заявленная доходность\n☐ Реалистичная загрузка объекта\n☐ Кто несёт операционные расходы\n☐ Условия выхода из проекта\n\n🏗 Застройщик:\n☐ История сданных объектов\n☐ Финансовая устойчивость\n☐ Судебные иски\n☐ Репутация в сообществе',
   category:'Обучение',tags:'чек-лист,проверка',type:'post',ico:'ico-edu',
   bg:'linear-gradient(135deg,#1a0820 0%,#401060 100%)',
   tgLink:'https://t.me/+c4ekMHlWBbQzYjUy',tgConsp:'https://t.me/+c4ekMHlWBbQzYjUy'},
];

const CATS={
  'Инвестиции':{ico:'ico-coin',  bg:'linear-gradient(135deg,#0a1855,#1e3a8a)',cnt:3},
  'Кейсы':     {ico:'ico-case',  bg:'linear-gradient(135deg,#1a0840,#3a1a80)',cnt:2},
  'Видео':     {ico:'ico-play',  bg:'linear-gradient(135deg,#0a3020,#1a6040)',cnt:1},
  'Аналитика': {ico:'ico-chart', bg:'linear-gradient(135deg,#301000,#602008)',cnt:1},
  'Новости':   {ico:'ico-news',  bg:'linear-gradient(135deg,#002030,#004060)',cnt:1},
  'Обучение':  {ico:'ico-edu',   bg:'linear-gradient(135deg,#1a0820,#401060)',cnt:1},
};

// Referral levels config
const LEVELS=[
  {name:'Приятель', req:0,  pts:0,    emoji:'👋'},
  {name:'Партнёр',  req:3,  pts:300,  emoji:'🤝'},
  {name:'Эксперт',  req:10, pts:1000, emoji:'⭐'},
  {name:'Топ',      req:25, pts:2500, emoji:'🏆'},
];

const LEADERBOARD_INIT=[
  {n:'Александр К.',sc:24,col:'#0a1855'},
  {n:'Мария В.',    sc:18,col:'#1a0840'},
  {n:'Дмитрий П.',  sc:11,col:'#0a3020'},
  {n:'Ольга С.',    sc:7, col:'#301000'},
  {n:'Игорь Н.',    sc:5, col:'#002030'},
];

// ══════════ STATE ═════════════════════════════════════
let CU=null,FAVS=new Set(),HFT='all',HST=null,CID=null;

function gU(){try{return JSON.parse(localStorage.getItem('inv_u')||'{}')}catch{return{}}}
function sU(u){localStorage.setItem('inv_u',JSON.stringify(u))}
function gS(){try{return JSON.parse(localStorage.getItem('inv_s')||'null')}catch{return null}}
function sS(u){localStorage.setItem('inv_s',JSON.stringify(u))}
function cSess(){localStorage.removeItem('inv_s')}
function gF(id){try{return new Set(JSON.parse(localStorage.getItem('inv_f_'+id)||'[]'))}catch{return new Set()}}
function svF(id,s){localStorage.setItem('inv_f_'+id,JSON.stringify([...s]))}
function hash(s){let h=0;for(let i=0;i<s.length;i++)h=Math.imul(31,h)+s.charCodeAt(i)|0;return h.toString(36)}

window.addEventListener('load',()=>{
  const s=gS();
  if(s){CU=s;FAVS=gF(s.id);launch();}
});

// ══════════ AUTH ══════════════════════════════════════
function sw(m){
  const il=m==='l';
  document.getElementById('bl').classList.toggle('on',il);
  document.getElementById('br').classList.toggle('on',!il);
  document.getElementById('fl').style.display=il?'':'none';
  document.getElementById('fr').style.display=il?'none':'';
  ['la','ra'].forEach(id=>document.getElementById(id).classList.remove('show'));
}
function tp(id,btn){const i=document.getElementById(id);i.type=i.type==='password'?'text':'password';btn.style.opacity=i.type==='text'?.7:.32;}
function sh(hid,fid,msg,t){
  const h=document.getElementById(hid),f=fid?document.getElementById(fid):null;
  h.textContent=msg;h.className='hint'+(msg?' '+(t==='er'?'er2':'ok'):'');
  if(f)f.classList.toggle('er',t==='er'&&!!msg);
}
function vN(){const v=document.getElementById('rn').value.trim();if(v&&v.length<2){sh('hn','rn','Минимум 2 символа','er');return false;}sh('hn','rn','','');return true;}
function vPh(){const v=document.getElementById('rph').value.replace(/\D/g,'');if(!v){sh('hph','rph','Обязательное поле','er');return false;}if(v.length<10){sh('hph','rph','Введите корректный номер','er');return false;}sh('hph','rph','Номер корректен','ok');return true;}
function vE(){
  const v=document.getElementById('rem').value.trim();
  if(!v){sh('hem','rem','Обязательное поле','er');return false;}
  if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v)){sh('hem','rem','Неверный формат email','er');return false;}
  if(Object.values(gU()).find(u=>u.email===v.toLowerCase())){sh('hem','rem','Email уже зарегистрирован','er');return false;}
  sh('hem','rem','Email доступен','ok');return true;
}
function vP(){
  const v=document.getElementById('rp').value,sf=document.getElementById('sf');
  if(!v){sh('hp','rp','Обязательное поле','er');sf.style.width='0';return false;}
  let s=0;if(v.length>=8)s++;if(/[A-ZА-Я]/.test(v))s++;if(/\d/.test(v))s++;if(/[^a-zA-Zа-яА-Я0-9]/.test(v))s++;
  const cs=['#e03050','#e8640a','#d4a011','#0baa6e'],ls=['Слабый','Средний','Хороший','Отличный'];
  sf.style.width=(s*25)+'%';sf.style.background=cs[s-1]||'#e03050';
  if(v.length<8){sh('hp','rp','Минимум 8 символов','er');return false;}
  sh('hp','rp','Надёжность: '+ls[s-1],'ok');
  if(document.getElementById('rp2').value)vP2();return true;
}
function vP2(){const v=document.getElementById('rp').value,v2=document.getElementById('rp2').value;if(!v2){sh('hp2','rp2','Обязательное поле','er');return false;}if(v!==v2){sh('hp2','rp2','Пароли не совпадают','er');return false;}sh('hp2','rp2','Пароли совпадают','ok');return true;}

function showA(id,msg){const e=document.getElementById(id);e.textContent=msg;e.classList.add('show');}

function doLogin(){
  const em=document.getElementById('le').value.trim().toLowerCase(),pw=document.getElementById('lp').value;
  document.getElementById('la').classList.remove('show');
  if(!em||!pw){showA('la','Заполните все поля');return;}
  const u=Object.values(gU()).find(u=>u.email===em);
  if(!u||u.ph!==hash(pw)){showA('la','Неверный email или пароль');return;}
  CU=u;FAVS=gF(u.id);sS(u);launch();
}
function doReg(){
  const a=vPh(),b=vE(),c=vP(),d=vP2();
  document.getElementById('ra').classList.remove('show');
  if(!a||!b||!c||!d){showA('ra','Исправьте ошибки выше');return;}
  const nm=document.getElementById('rn').value.trim();
  const ph=document.getElementById('rph').value.replace(/\D/g,'');
  const em=document.getElementById('rem').value.trim().toLowerCase();
  const pw=document.getElementById('rp').value;
  const users=gU(),id=Date.now();
  const u={id,name:nm||'Инвестор',phone:ph,email:em,ph:hash(pw),refs:0,pts:0};
  users[id]=u;sU(users);
  CU=u;FAVS=new Set();sS(u);
  launch();showT('Добро пожаловать в INVESTAT!');
}
function doLogout(){
  CU=null;FAVS=new Set();cSess();
  document.getElementById('app-screen').classList.remove('active');
  document.getElementById('auth-screen').classList.add('active');
  ['le','lp','rn','rph','rem','rp','rp2'].forEach(id=>{const e=document.getElementById(id);if(e)e.value='';});
  document.getElementById('sf').style.width='0';
  ['hn','hph','hem','hp','hp2'].forEach(id=>{const e=document.getElementById(id);if(e){e.textContent='';e.className='hint';}});
  sw('l');
}

// ══════════ APP ═══════════════════════════════════════
function launch(){
  document.getElementById('auth-screen').classList.remove('active');
  document.getElementById('app-screen').classList.add('active');
  updateUI();renderHome();renderCollections();renderLB();renderLevels();
}

function getCurrentLevel(){
  const refs=CU?.refs||0;
  let lv=LEVELS[0];
  for(const l of LEVELS){if(refs>=l.req)lv=l;}
  return lv;
}

function updateUI(){
  if(!CU)return;
  const init=(CU.name||'I')[0].toUpperCase();
  document.getElementById('topav').textContent=init;
  document.getElementById('amav').textContent=init;
  document.getElementById('amname').textContent=CU.name||'Инвестор';
  const lv=getCurrentLevel();
  document.getElementById('amlvl').textContent=lv.emoji+' '+lv.name;
  document.getElementById('arefs').textContent=CU.refs||0;
  document.getElementById('acols').textContent=FAVS.size;
  document.getElementById('apts').textContent=(CU.pts||0);
  const rl='https://t.me/investat_bot?start=ref_'+CU.id;
  document.getElementById('refl').textContent=rl;
  document.getElementById('hrl').textContent=rl;
  // Progress to next level
  const refs=CU.refs||0;
  const curIdx=LEVELS.indexOf(lv);
  const next=LEVELS[curIdx+1];
  if(next){
    const pct=Math.round((refs-lv.req)/(next.req-lv.req)*100);
    setTimeout(()=>{document.getElementById('pgfill').style.width=pct+'%';},500);
    document.getElementById('pgtitle').textContent='До уровня «'+next.name+'»';
    document.getElementById('pgsub').textContent='Пригласите ещё '+(next.req-refs)+' '+(next.req-refs===1?'участника':'участников');
  } else {
    setTimeout(()=>{document.getElementById('pgfill').style.width='100%';},500);
    document.getElementById('pgtitle').textContent='Максимальный уровень достигнут!';
    document.getElementById('pgsub').textContent='Вы в топе амбассадоров INVESTAT';
  }
}

function renderLevels(){
  const refs=CU?.refs||0;
  document.getElementById('lvlcards').innerHTML=LEVELS.map(l=>{
    const active=refs>=l.req;
    return `<div class="lvlcard${active?' active':''}">
      <div class="lvl-ico">${l.emoji}</div>
      <div class="lvl-name">${l.name}</div>
      <div class="lvl-req">${l.req===0?'Старт':l.req+' приглаш.'}</div>
    </div>`;
  }).join('');
}

// ══════════ HOME ══════════════════════════════════════
function renderHome(){
  document.getElementById('catg').innerHTML=Object.entries(CATS).map(([name,m])=>`
    <div class="ccard" style="background:${m.bg}" onclick="filterByCat('${name}')">
      <div class="ccard-ov"></div>
      <div class="ccard-illus"><svg width="60" height="60" viewBox="0 0 80 80"><use href="#${m.ico}" color="white"/></svg></div>
      <div class="ccard-body">
        <div class="ccard-cnt">${m.cnt} материал${m.cnt===1?'':'а'}</div>
        <div class="ccard-name">${name}</div>
      </div>
    </div>`).join('');

  document.getElementById('recl').innerHTML=POSTS.slice(0,5).map(p=>`
    <div class="rpost" onclick="openPost(${p.id})">
      <div class="rthumb" style="background:${p.bg}">
        <div class="rthumb-ov"><svg width="30" height="30" viewBox="0 0 80 80"><use href="#${p.ico}" color="white"/></svg></div>
      </div>
      <div class="ri">
        <div class="rt">${p.title}</div>
        <div class="rm">
          <span class="badge ${bc(p.type)}">${tl(p.type)}</span>
          <span style="font-size:11px;color:#7777aa">${p.category}</span>
        </div>
      </div>
    </div>`).join('');
}

function onHS(){
  clearTimeout(HST);
  HST=setTimeout(()=>{
    const q=document.getElementById('hsi').value.trim().toLowerCase();
    const show=q||HFT!=='all';
    document.getElementById('hsr').style.display=show?'':'none';
    document.getElementById('hdef').style.display=show?'none':'';
    if(show)renderPCards(document.getElementById('hsr'),fP(q,HFT));
  },260);
}

function setHC(el,type){
  document.querySelectorAll('#hchips .chip').forEach(c=>c.classList.remove('on'));
  el.classList.add('on');HFT=type;onHS();
}

function filterByCat(cat){
  gt('home',document.querySelectorAll('.ntab')[0]);
  document.getElementById('hsi').value='';HFT='all';
  document.querySelectorAll('#hchips .chip').forEach((c,i)=>c.classList.toggle('on',i===0));
  document.getElementById('hdef').style.display='none';
  document.getElementById('hsr').style.display='';
  renderPCards(document.getElementById('hsr'),POSTS.filter(p=>p.category===cat));
}

function fP(q,type){
  return POSTS.filter(p=>{
    const mq=!q||(p.title+p.content+p.tags).toLowerCase().includes(q);
    return mq&&(type==='all'||p.type===type);
  });
}

function renderPCards(el,posts){
  if(!posts.length){el.innerHTML=`<div class="empty"><div class="empt">Ничего не найдено</div><div class="emps">Попробуйте другой запрос или фильтр</div></div>`;return;}
  el.innerHTML=posts.map(p=>`
    <div class="pcard" onclick="openPost(${p.id})">
      <div class="pcard-img" style="background:${p.bg}">
        <svg width="60" height="60" viewBox="0 0 80 80" style="position:relative;z-index:1"><use href="#${p.ico}" color="white"/></svg>
        <div class="pcard-img-ov"></div>
      </div>
      <div class="pcard-body">
        <div class="pcard-top">
          <div class="pcard-title">${p.title}</div>
          <button class="favbtn ${FAVS.has(p.id)?'on':''}" onclick="event.stopPropagation();togFav(${p.id},this)">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="${FAVS.has(p.id)?'#fbbf24':'none'}" stroke="${FAVS.has(p.id)?'#fbbf24':'#7777aa'}" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
          </button>
        </div>
        <div class="pcard-prev">${p.content}</div>
        <div class="pcard-foot">
          <span class="badge ${bc(p.type)}">${tl(p.type)}</span>
          ${p.tags.split(',').slice(0,2).map(t=>`<span class="tag">#${t.trim()}</span>`).join('')}
        </div>
      </div>
    </div>`).join('');
}

// ══════════ COLLECTIONS ════════════════════════════════
function renderCollections(){
  const posts=POSTS.filter(p=>FAVS.has(p.id));
  const el=document.getElementById('colllist');
  if(!posts.length){
    el.innerHTML=`<div class="empty">
      <div style="width:64px;height:64px;border-radius:16px;background:linear-gradient(135deg,#0a1855,#1e3a8a);display:flex;align-items:center;justify-content:center;margin:0 auto 14px">
        <svg width="32" height="32" viewBox="0 0 80 80"><use href="#ico-coin" color="white"/></svg>
      </div>
      <div class="empt">Подборки пусты</div>
      <div class="emps">Нажми на звезду в материале, чтобы сохранить</div>
    </div>`;return;
  }
  el.innerHTML=posts.map(p=>`
    <div class="pcard" onclick="openPost(${p.id})">
      <div class="pcard-img" style="background:${p.bg}">
        <svg width="60" height="60" viewBox="0 0 80 80" style="position:relative;z-index:1"><use href="#${p.ico}" color="white"/></svg>
        <div class="pcard-img-ov"></div>
      </div>
      <div class="pcard-body">
        <div class="pcard-top">
          <div class="pcard-title">${p.title}</div>
          <button class="favbtn on" onclick="event.stopPropagation();togFav(${p.id},this)">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="#fbbf24" stroke="#fbbf24" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
          </button>
        </div>
        <div class="pcard-prev">${p.content}</div>
        <div class="pcard-foot"><span class="badge ${bc(p.type)}">${tl(p.type)}</span></div>
      </div>
    </div>`).join('');
}

function togFav(id,btn){
  const was=FAVS.has(id);
  if(was){FAVS.delete(id);btn.innerHTML=`<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#7777aa" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`;btn.classList.remove('on');}
  else{FAVS.add(id);btn.innerHTML=`<svg width="18" height="18" viewBox="0 0 24 24" fill="#fbbf24" stroke="#fbbf24" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`;btn.classList.add('on');showT('Добавлено в подборки');}
  if(CU){svF(CU.id,FAVS);document.getElementById('acols').textContent=FAVS.size;}
  if(CID===id){const sv=document.getElementById('dfsvg');sv.setAttribute('fill',FAVS.has(id)?'#fbbf24':'none');sv.setAttribute('stroke',FAVS.has(id)?'#fbbf24':'currentColor');}
}

// ══════════ LEADERBOARD ════════════════════════════════
function renderLB(){
  // Merge real user into leaderboard if they have refs
  let board=[...LEADERBOARD_INIT];
  if(CU&&(CU.refs||0)>0){
    board.push({n:CU.name||'Вы',sc:CU.refs||0,col:'#3d5af1',isMe:true});
    board.sort((a,b)=>b.sc-a.sc);
    board=board.slice(0,7);
  }
  document.getElementById('lbd').innerHTML=board.map((u,i)=>{
    const rc=['r1','r2','r3','rn','rn','rn','rn'][i]||'rn';
    return `<div class="lbi${u.isMe?' me':''}">
      <div class="lbr ${rc}">${i+1}</div>
      <div class="lbav" style="background:${u.col}">${u.n[0]}</div>
      <div class="lbn">${u.n}${u.isMe?' (вы)':''}</div>
      <div class="lbs">${u.sc}</div>
    </div>`;
  }).join('');
}

// ══════════ POST DETAIL ════════════════════════════════
function openPost(id){
  const p=POSTS.find(x=>x.id===id);if(!p)return;
  CID=id;
  const h=document.getElementById('dhero');
  h.style.background=p.bg;
  document.getElementById('dherosvg').innerHTML=`<use href="#${p.ico}" color="white"/>`;
  document.getElementById('dht').textContent=p.title;
  document.getElementById('dbd').innerHTML=`<span class="badge ${bc(p.type)}">${tl(p.type)}</span><span style="margin-left:6px;font-size:11px;color:#7777aa">${p.category}</span>`;
  document.getElementById('dtit').textContent=p.title;
  document.getElementById('dbody').textContent=p.content;
  document.getElementById('dtags').innerHTML=p.tags.split(',').map(t=>`<span class="tag">#${t.trim()}</span>`).join('');
  document.getElementById('dwatch').href=p.tgLink||'https://t.me/+c4ekMHlWBbQzYjUy';
  document.getElementById('dconsp').href=p.tgConsp||'https://t.me/+c4ekMHlWBbQzYjUy';
  const f=FAVS.has(id);const sv=document.getElementById('dfsvg');
  sv.setAttribute('fill',f?'#fbbf24':'none');sv.setAttribute('stroke',f?'#fbbf24':'currentColor');
  document.getElementById('det').classList.add('show');
  document.getElementById('det').scrollTop=0;
}
function closeDet(){document.getElementById('det').classList.remove('show');CID=null;renderCollections();}
function togDF(){if(CID===null)return;togFav(CID,document.getElementById('dfav'));}

// ══════════ NAV ════════════════════════════════════════
function gt(name,el){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.ntab').forEach(t=>t.classList.remove('on'));
  document.getElementById('page-'+name).classList.add('active');
  el.classList.add('on');
  const T={home:'Главная',community:'О сообществе',projects:'Проекты',collections:'Подборки',ambassadors:'Амбассадоры'};
  document.getElementById('ptitle').textContent=T[name]||'';
  if(name==='collections')renderCollections();
  if(name==='ambassadors'){updateUI();renderLevels();renderLB();}
}

// ══════════ UTILS ══════════════════════════════════════
function bc(t){return{post:'b-post',video:'b-video',invest:'b-invest',case:'b-case',news:'b-news'}[t]||'b-post';}
function tl(t){return{post:'Пост',video:'Видео',invest:'Инвестиции',case:'Кейс',news:'Новости'}[t]||t;}
function ol(u){window.open(u,'_blank');}
function cpRef(){const t=document.getElementById('refl').textContent;navigator.clipboard?.writeText(t).then(()=>showT('Ссылка скопирована!')).catch(()=>showT('Скопируй вручную'));}
function cpHR(){const t=document.getElementById('hrl').textContent;navigator.clipboard?.writeText(t).then(()=>showT('Ссылка скопирована!')).catch(()=>showT('Скопируй вручную'));}
function showT(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2400);}
</script>
</body>
</html>
